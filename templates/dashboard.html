<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MonthVest - Dashboard</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body { margin:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f5f6fa; }
    .container { display:flex; height:100vh; }

    .sidebar {
        width:220px;
        background:#6a11cb;
        color:#fff;
        padding:30px 20px;
        display:flex;
        flex-direction:column;
    }

    .sidebar a {
        color:#fff;
        text-decoration:none;
        font-size:1.1rem;
        margin-bottom:20px;
        padding:10px;
        border-radius:6px;
        display:flex;
        align-items:center;
    }

    .sidebar a:hover { background:#2575fc; }
    .sidebar a i { margin-right:10px; }

    .main-content { flex:1; padding:30px; overflow-y:auto; }

    .cards { display:flex; flex-wrap:wrap; gap:20px; margin-bottom:30px; }
    .card {
        background:#fff;
        padding:20px;
        border-radius:10px;
        flex:1;
        min-width:180px;
        box-shadow:0 4px 12px rgba(0,0,0,0.1);
        text-align:center;
    }

    .card h3 { margin:0; font-size:1rem; color:#888; }
    .card p { margin-top:10px; font-size:1.5rem; color:#2575fc; font-weight:bold; }

    .chart-row {
        display: flex;
        gap: 20px;
        margin-top: 30px;
    }

    .chart-box {
        background:#fff;
        padding:20px;
        border-radius:10px;
        box-shadow:0 4px 12px rgba(0,0,0,0.1);
        flex:1;
    }

    .table-box { margin-top:30px; }

    table {
        width:100%;
        background:#fff;
        border-collapse:collapse;
        box-shadow:0 4px 12px rgba(0,0,0,0.1);
        border-radius:8px;
        overflow:hidden;
    }

    th, td { padding:12px 15px; text-align:left; }
    th { background:#2575fc; color:#fff; }
    tr:nth-child(even) { background:#f2f2f2; }
</style>
</head>

<body>

<div class="container">

    <!-- SIDEBAR WITH ALL BUTTONS -->
    <div class="sidebar">
        <a href="{{ url_for('dashboard') }}"><i class="fas fa-home"></i> Dashboard</a>
        <a href="{{ url_for('add_investment_page') }}"><i class="fas fa-plus-circle"></i> Add Investment</a>
        <a href="{{ url_for('edit_delete_page') }}"><i class="fas fa-edit"></i> Edit / Delete</a>
        <a href="{{ url_for('portfolio_trends_page') }}"><i class="fas fa-chart-line"></i> Portfolio Trends</a>
        <a href="{{ url_for('investment_tips_page') }}"><i class="fas fa-lightbulb"></i> Investment Tips</a>
        <a href="{{ url_for('reports_page') }}"><i class="fas fa-file-alt"></i> Reports</a>
        <a href="{{ url_for('user_profile_page') }}"><i class="fas fa-user"></i> User Profile</a>
        <a href="{{ url_for('logout') }}">
        <i class="fas fa-sign-out-alt"></i> Logout
</a>

    
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">

        <h2>Welcome, {{ session['fullname'] }}</h2>

        <!-- SUMMARY CARDS -->
        <div class="cards">
            <div class="card">
                <h3>Total Investment</h3>
                <p>₹{{ totalInvestment }}</p>
            </div>
            <div class="card">
                <h3>Current Value</h3>
                <p>₹{{ totalCurrentValue }}</p>
            </div>
            <div class="card">
                <h3>Total Profit / Loss</h3>
                <p>₹{{ totalProfitLoss }}</p>
            </div>
            <div class="card">
                <h3>ROI</h3>
                <p>{{ roi }}%</p>
            </div>
        </div>

        <!-- TWO CHARTS SIDE BY SIDE -->
        <div class="chart-row">
            <div class="chart-box">
                <h3>Investment Type Distribution</h3>
                <canvas id="pieChart"></canvas>
            </div>

            <div class="chart-box">
                <h3>Portfolio Growth Over Time</h3>
                <canvas id="lineChart"></canvas>
            </div>
        </div>

        <!-- TABLE -->
        <div class="table-box">
            <h3>Your Investments</h3>
            <table>
                <tr>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>Date</th>
                    <th>Current Value</th>
                </tr>

                {% for inv in investments %}
                <tr>
                    <td>{{ inv.type }}</td>
                    <td>{{ inv.amount }}</td>
                    <td>{{ inv.date }}</td>
                    <td>{{ inv.currentValue }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>

    </div>
</div>

<script>
    const investments = {{ investments | tojson }};

    /* -------- PIE CHART -------- */
    let typeTotals = {};

    investments.forEach(inv => {
        let t = inv.type.trim().toLowerCase();

        if (t.includes("mutual")) t = "Mutual Funds";
        else if (t.includes("fixed") || t === "fd") t = "FD";
        else if (t.includes("gold")) t = "Gold";
        else t = inv.type;

        if (!typeTotals[t]) typeTotals[t] = 0;
        typeTotals[t] += parseFloat(inv.currentValue);
    });

    new Chart(document.getElementById('pieChart'), {
        type: 'pie',
        data: {
            labels: Object.keys(typeTotals),
            datasets: [{
                data: Object.values(typeTotals),
                borderWidth: 1
            }]
        }
    });

    /* -------- LINE CHART -------- */
    let dateMap = {};

    investments.forEach(inv => {
        if (!dateMap[inv.date]) dateMap[inv.date] = 0;
        dateMap[inv.date] += parseFloat(inv.currentValue);
    });

    const sortedDates = Object.keys(dateMap).sort();
    const sortedValues = sortedDates.map(d => dateMap[d]);

    new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: sortedDates,
            datasets: [{
                label: "Total Portfolio Value",
                data: sortedValues,
                borderWidth: 2,
                tension: 0.4
            }]
        }
    });
</script>

</body>
</html>
