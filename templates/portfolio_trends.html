<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portfolio Trends - MonthVest</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { margin: 0; font-family: Arial; background: #f5f6fa; }
.sidebar { width: 220px; background: #6a11cb; height: 100vh; padding: 20px; position: fixed; color: #fff; }
.sidebar a { display: block; padding: 10px; color: #fff; text-decoration: none; margin-bottom: 10px; }
.main-content { margin-left: 240px; padding: 30px; }
.box { background: white; padding: 20px; border-radius: 10px; width: 23%; text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
.summary-boxes { display: flex; gap: 20px; flex-wrap: wrap; }
canvas { background: white; padding: 10px; border-radius: 10px; margin-top: 30px; }
</style>
</head>

<body>

<div class="sidebar">
    <a href="/dashboard">Dashboard</a>
    <a href="/add-investment-page">Add Investment</a>
    <a href="/edit_delete">Edit/Delete</a>
    <a href="/portfolio_trends">Portfolio Trends</a>
    <a href="/investment_tips">Investment Tips</a>
    <a href="/reports">Reports</a>
</div>

<div class="main-content">

    <h2>Portfolio Trends</h2>

    <div class="summary-boxes">
        <div class="box">
            <h3>Best Performing</h3>
            <p id="bestCat">-</p>
        </div>

        <div class="box">
            <h3>Worst Performing</h3>
            <p id="worstCat">-</p>
        </div>

        <div class="box">
            <h3>Total Invested</h3>
            <p id="totalInvested">0</p>
        </div>

        <div class="box">
            <h3>Total Returns</h3>
            <p id="totalReturns">0</p>
        </div>
    </div>

    <canvas id="barChart" height="120"></canvas>
    <canvas id="lineChart" height="120"></canvas>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const user = "{{ fullname }}";

    fetch(`/api/investments/${user}`)
        .then(res => res.json())
        .then(data => {

            if (data.length === 0) return;

            let totalInvested = data.reduce((a, b) => a + b.amount, 0);
            let totalReturns = data.reduce((a, b) => a + b.profit, 0);

            document.getElementById("totalInvested").innerText = totalInvested;
            document.getElementById("totalReturns").innerText = totalReturns;

            let best = data.reduce((a, b) => a.profit > b.profit ? a : b);
            let worst = data.reduce((a, b) => a.profit < b.profit ? a : b);

            document.getElementById("bestCat").innerText = `${best.type} (${best.profit})`;
            document.getElementById("worstCat").innerText = `${worst.type} (${worst.profit})`;

            loadBarChart(data);
            loadLineChart(data);
        });
});

function loadBarChart(data) {
    new Chart(document.getElementById("barChart"), {
        type: "bar",
        data: {
            labels: data.map(i => i.type),
            datasets: [{
                label: "Profit/Loss",
                data: data.map(i => i.profit)
            }]
        }
    });
}

function loadLineChart(data) {
    new Chart(document.getElementById("lineChart"), {
        type: "line",
        data: {
            labels: data.map(i => i.type),
            datasets: [{
                label: "Investment Amount",
                data: data.map(i => i.amount)
            }]
        }
    });
}
</script>

</body>
</html>
