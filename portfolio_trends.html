<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MonthVest - Portfolio Trends</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body { font-family: Arial, sans-serif; margin: 0; background-color: #f5f6fa; display: flex; }

    /* Sidebar */
    .sidebar {
        width: 220px; background-color: #6a11cb; color: #fff; display: flex; flex-direction: column; padding: 30px 20px; height: 100vh; position: fixed;
    }
    .sidebar a { color: #fff; text-decoration: none; margin-bottom: 20px; font-size: 1.1rem; transition: 0.2s; padding: 10px; border-radius: 6px; display: flex; align-items: center; }
    .sidebar a:hover { background-color: #7b33d6; }
    .sidebar a i { margin-right: 10px; }

    /* Main content */
    .main-content { margin-left: 240px; padding: 30px; width: calc(100% - 240px); }
    h2 { margin-bottom: 20px; }

    .summary-boxes { display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
    .box { background-color: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); flex: 1; min-width: 200px; text-align: center; }
    .box h3 { margin: 0 0 10px 0; color: #6a11cb; }
    canvas { background-color: #fff; border-radius: 10px; padding: 10px; margin-bottom: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
    <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
    <a href="add_investment.html"><i class="fas fa-plus-circle"></i> Add Investment</a>
    <a href="edit_delete.html"><i class="fas fa-edit"></i> Edit / Delete</a>
    <a href="portfolio_trends.html"><i class="fas fa-chart-line"></i> Portfolio Trends</a>
    <a href="investment_tips.html"><i class="fas fa-lightbulb"></i> Investment Tips</a>
    <a href="reports.html"><i class="fas fa-file-alt"></i> Reports</a>
    <a href="user_profile.html"><i class="fas fa-user-circle"></i> User Profile</a>
</div>

<!-- Main Content -->
<div class="main-content">
    <h2>Portfolio Trends</h2>

    <div class="summary-boxes">
        <div class="box" id="best-category"><h3>Best Performing</h3><p id="bestCat">-</p></div>
        <div class="box" id="worst-category"><h3>Worst Performing</h3><p id="worstCat">-</p></div>
        <div class="box" id="total-invested"><h3>Total Invested</h3><p id="totalInvested">$0</p></div>
        <div class="box" id="total-returns"><h3>Total Returns</h3><p id="totalReturns">$0</p></div>
    </div>

    <canvas id="barChart" height="150"></canvas>
    <canvas id="lineChart" height="150"></canvas>
</div>

<script>
// Fetch investment data
let investments = JSON.parse(localStorage.getItem('investments')) || [];

// Extract unique investment types
let investmentTypes = [...new Set(investments.map(inv => inv.type))];

// Calculate returns for each type
let typeReturns = investmentTypes.map(type => {
    return investments
        .filter(inv => inv.type === type)
        .reduce((acc, inv) => acc + (inv.currentValue - inv.amount), 0);
});

// Best/Worst performing
if(investmentTypes.length > 0){
    let maxReturn = Math.max(...typeReturns);
    let minReturn = Math.min(...typeReturns);
    document.getElementById('bestCat').innerText = investmentTypes[typeReturns.indexOf(maxReturn)];
    document.getElementById('worstCat').innerText = investmentTypes[typeReturns.indexOf(minReturn)];
}

// Total invested & returns
let totalInvested = investments.reduce((acc, inv) => acc + inv.amount, 0);
let totalReturns = investments.reduce((acc, inv) => acc + (inv.currentValue - inv.amount), 0);
document.getElementById('totalInvested').innerText = `$${totalInvested.toFixed(2)}`;
document.getElementById('totalReturns').innerText = `$${totalReturns.toFixed(2)}`;

// Bar Chart - Category-wise returns
const barCtx = document.getElementById('barChart').getContext('2d');
new Chart(barCtx, {
    type: 'bar',
    data: {
        labels: investmentTypes,
        datasets: [{
            label: 'Returns ($)',
            data: typeReturns,
            backgroundColor: investmentTypes.map((_,i) => `hsl(${i*60 % 360}, 70%, 50%)`)
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
    }
});

// Line Chart - Monthly growth (simulate evenly distributed daily returns)
let days = Array.from({length:30}, (_,i)=>i+1);
let portfolioValue = days.map(day => totalInvested + (totalReturns/30)*day);

const lineCtx = document.getElementById('lineChart').getContext('2d');
new Chart(lineCtx, {
    type: 'line',
    data: {
        labels: days.map(d=>`Day ${d}`),
        datasets: [{
            label: 'Portfolio Value ($)',
            data: portfolioValue,
            borderColor: '#6a11cb',
            backgroundColor: 'rgba(106,17,203,0.2)',
            tension: 0.3
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { display: true } },
        scales: { y: { beginAtZero: true } }
    }
});
</script>

</body>
</html>
